/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package in.ac.dei.mhrd.omr;

import java.io.*;


import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

/** 
 * MyEclipse Struts
 * Creation date: 12-07-2010
 * 
 * XDoclet definition:
 * @struts.action input="/Menu.jsp" validate="true"
 * @struts.action-forward name="home" path="/Home.jsp"
 */
public class DowLoadSheetAction extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws ServletException 
	 * @throws IOException 
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		
		String base="OMRSheetTemplate.pdf";
	   	int index=base.lastIndexOf(".");
	   	int length=base.length();
	   	String extension=base.substring(index,length);
	    String parent="OMRSheetTemplate";   
	    String filename=parent+extension;

	// you can  write http://localhost
	  // String filepath="f:/"+base;
	   String filepath = getServlet().getServletContext().getRealPath(
		"/")
		+ "OMRSheet"+"//" + base;


	BufferedInputStream buf=null;
	ServletOutputStream myOut=null;

	try{

	myOut = response.getOutputStream( );
	     File myfile = new File(filepath);
	     
	     //set response headers
	     response.setContentType("application/pdf");
	     
	     response.addHeader(
	        "Content-Disposition","attachment; filename="+filename );

	     response.setContentLength( (int) myfile.length( ) );
	     
	     FileInputStream input = new FileInputStream(myfile);
	     buf = new BufferedInputStream(input);
	     int readBytes = 0;

	     //read from the file; write to the ServletOutputStream
	     while((readBytes = buf.read( )) != -1)
	       myOut.write(readBytes);

	} catch (IOException ioe){
	     
	        throw new ServletException(ioe.getMessage());
	         
	     } finally {
	         
	     //close the input/output streams
	         if (myOut != null)
	             myOut.close();
	          if (buf != null)
	          buf.close();
	         
	     }
		return mapping.findForward("home");

		
	}
}