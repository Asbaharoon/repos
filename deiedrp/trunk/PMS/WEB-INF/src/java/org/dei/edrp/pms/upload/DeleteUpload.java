/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package org.dei.edrp.pms.upload;

import java.io.File;
import java.sql.Connection;
import java.sql.PreparedStatement;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import org.dei.edrp.pms.dataBaseConnection.MyDataSource;

/** 
 * MyEclipse Struts
 * Creation date: 11-14-2009
 * 
 * XDoclet definition:
 * @struts.action path="/deleteupload" name="uploadfileform" input="/WEB-INF/JspFiles/upload/download.jsp" scope="request" validate="true"
 */
public class DeleteUpload extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		
				//System.out.println("File Name"+request.getParameter("fileName")+", Onwer"+request.getParameter("owner")+"and Project"+request.getParameter("projectName"));
				Connection con=null;
				try{
					con=MyDataSource.getConnection();
					PreparedStatement ps=null;
						
				ps=con.prepareStatement("delete from file where file_name=? and owner=? and project_name=?");
				ps.setString(1, (String)request.getParameter("fileName"));
				ps.setString(2,(String)request.getParameter("owner"));
				ps.setString(3, (String)request.getParameter("projectName"));
//				System.out.println("Query executed");
				int x=ps.executeUpdate();
				if(x>0)
				{
					String filePath = getServlet().getServletContext().getRealPath("/")+"upload"+("/")+request.getParameter("owner")+("/")+(String)request.getParameter("projectName");
//					System.out.println(filePath);
					File f=new File(filePath,(String)request.getParameter("fileName"));
					f.delete();
				}
			}catch(Exception e)
			{
				//System.out.println("error in multidelete"+e);
				}
			finally
			{
				MyDataSource.freeConnection(con);
			}
			return mapping.findForward("view");
		}
	}